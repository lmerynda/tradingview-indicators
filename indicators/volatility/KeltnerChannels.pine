// This source code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// Â© TradingView Indicators

//@version=5
indicator("Keltner Channels", shorttitle="KC", overlay=true)

// Inputs
length = input.int(20, minval=1, title="Length")
mult = input.float(2.0, minval=0.001, maxval=50, step=0.1, title="Multiplier")
src = input.source(close, title="Source")
maType = input.string("EMA", title="MA Type", options=["SMA", "EMA", "WMA"])
atrLength = input.int(10, minval=1, title="ATR Length")

// Function to get MA value based on type
getMA(source, len, matype) =>
    switch matype
        "SMA" => ta.sma(source, len)
        "EMA" => ta.ema(source, len)
        "WMA" => ta.wma(source, len)
        => ta.ema(source, len)

// Keltner Channels Calculation
basis = getMA(src, length, maType)
range_value = mult * ta.atr(atrLength)
upperChannel = basis + range_value
lowerChannel = basis - range_value

// Plot
plot(basis, title="Basis (Middle Channel)", color=color.orange, linewidth=2)
p1 = plot(upperChannel, title="Upper Channel", color=color.blue, linewidth=1)
p2 = plot(lowerChannel, title="Lower Channel", color=color.blue, linewidth=1)
fill(p1, p2, color=color.new(color.blue, 95), title="Channel Fill")

// Color bars based on position relative to channels
barcolor(close > upperChannel ? color.green : close < lowerChannel ? color.red : na, title="Channel Breakout Color")

// Alert conditions
alertcondition(ta.cross(close, upperChannel), title="Price Crosses Upper Channel", message="Price crossed upper Keltner Channel")
alertcondition(ta.cross(lowerChannel, close), title="Price Crosses Lower Channel", message="Price crossed lower Keltner Channel")
