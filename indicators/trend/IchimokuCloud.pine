// This source code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// Â© TradingView Indicators

//@version=5
indicator("Ichimoku Cloud", shorttitle="Ichimoku", overlay=true)

// Inputs
tenkanLength = input.int(9, minval=1, title="Tenkan-sen Length")
kijunLength = input.int(26, minval=1, title="Kijun-sen Length")
chikouLength = input.int(26, minval=1, title="Chikou Span Length")
senkouSpanBLength = input.int(52, minval=1, title="Senkou Span B Length")
displacement = input.int(26, minval=1, title="Displacement")

// Calculations
donchian(len) => math.avg(ta.lowest(len), ta.highest(len))

tenkanSen = donchian(tenkanLength)
kijunSen = donchian(kijunLength)
senkouSpanA = math.avg(tenkanSen, kijunSen)
senkouSpanB = donchian(senkouSpanBLength)
chikouSpan = close

// Plot
plot(tenkanSen, title="Tenkan-sen", color=color.red, linewidth=1)
plot(kijunSen, title="Kijun-sen", color=color.blue, linewidth=1)
plot(close, title="Chikou Span", offset=-displacement, color=color.purple, linewidth=1)

// Senkou Span A and B with displacement
senkouA = plot(senkouSpanA, title="Senkou Span A", offset=displacement, color=color.green, linewidth=1)
senkouB = plot(senkouSpanB, title="Senkou Span B", offset=displacement, color=color.red, linewidth=1)

// Cloud fill
fill(senkouA, senkouB, color=senkouSpanA > senkouSpanB ? color.new(color.green, 90) : color.new(color.red, 90), title="Cloud")

// Alert conditions
alertcondition(ta.cross(tenkanSen, kijunSen), title="TK Cross", message="Tenkan-sen crossed Kijun-sen")
alertcondition(ta.cross(close, kijunSen), title="Price/Kijun Cross", message="Price crossed Kijun-sen")
