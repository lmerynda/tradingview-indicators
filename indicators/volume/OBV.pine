// This source code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// Â© TradingView Indicators

//@version=5
indicator("On-Balance Volume (OBV)", shorttitle="OBV", overlay=false)

// Inputs
length = input.int(20, minval=1, title="MA Length")
showMA = input.bool(true, title="Show Moving Average")
maType = input.string("EMA", title="MA Type", options=["SMA", "EMA"])

// OBV Calculation
obv = ta.cum(math.sign(ta.change(close)) * volume)

// Function to get MA value based on type
getMA(source, len, matype) =>
    switch matype
        "SMA" => ta.sma(source, len)
        "EMA" => ta.ema(source, len)
        => ta.ema(source, len)

// Calculate MA
obvMA = getMA(obv, length, maType)

// Plot
plot(obv, title="OBV", color=color.blue, linewidth=2)
plot(showMA ? obvMA : na, title="OBV MA", color=color.orange, linewidth=2)

// Color bars based on OBV trend
barcolor(obv > obvMA ? color.green : color.red, title="OBV Trend Color")

// Alert conditions
alertcondition(ta.cross(obv, obvMA), title="OBV Crosses MA", message="OBV crossed its moving average")
